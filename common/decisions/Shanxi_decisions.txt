SHX_xishan_fuxiang_power_struggle = {#逐鹿山西
	SHX_looming_gmj_coup = {#国民军预备谋反
		icon = GFX_decision_lkmt_flag 

		allowed = {
			always = no
		}
		available = {
			custom_trigger_tooltip = {
				tooltip = SHX_special_coup_circumstances_tooltip
				has_defensive_war = yes
			}
		}
		cancel_trigger = {
			has_country_flag = SHX_yan_victory_over_gmj
		}

		priority = 100 
		is_good = no
		days_mission_timeout = 1000

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_looming_gmj_coup"
			if = {
				limit = {
					NOT = { 
						# has_game_rule = { 
						# 	rule = SHX_forpol 
						# 	option = SHX_FORPOL_QIE 
						# } 
					}
				}
				country_event = shx.powerstruggle.9
			}
			else = {
				SHX_yan_victory_effect = yes
			}
		}
		timeout_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision timeout SHX_looming_gmj_coup"
			if = {
				limit = {
					NOT = { 
						# has_game_rule = { 
						# 	rule = SHX_path 
						# 	option = SHX_PATH_PATAUT 
						# } 
					}
					NOT = { 
						# has_game_rule = { 
						# 	rule = SHX_forpol 
						# 	option = SHX_FORPOL_QIE 
						# } 
					}
				}
				SHX_feng_victory_effect = yes
			}
			else = {
				SHX_yan_victory_effect = yes
			}
		}
	}

	SHX_purge_the_gmj = {#清洗国民军
		icon = GFX_decision_chinese_flag
		visible = {
			has_active_mission = SHX_looming_gmj_coup
			has_completed_focus = SHX_yu_tai_yuan_shang_hui_de_mi_tan
		}
		available = {
			OR = {
				is_power_balance_in_range = {
					id = SHX_power_balance
					range = SHX_bop_pacified_range
				}
				is_power_balance_in_range = {
					id = SHX_power_balance
					range = SHX_bop_extinguished_range
				}
			}
		}
		priority = 100 #Make this on top of category
		ai_will_do = {
			base = 0
			modifier = { #start considering taking if its already been over a year
				add = 50
				date > 1937.3.15
			}
			modifier = { #start considering taking if its already been over two years
				add = 50
				date > 1938.3.15
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_purge_the_gmj"
			SHX_yan_victory_effect = yes
		}
	}

	#Shanxi Agriculture Decisions
	SHX_agricultural_reform_mission_timer = {#山西的土地改革进程
		icon = GFX_decision_generic_agriculture
		allowed = {
			always = no
		}
		available = {
			OR = {
				has_country_flag = SHX_agricultural_reform_completed_flag
				has_country_flag = SHX_lategame_begin_flag
			}
		}

		fire_only_once = yes
		is_good = yes
		priority = 35
		days_mission_timeout = 600

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_agricultural_reform_mission_timer"
		}
		timeout_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision timeout SHX_agricultural_reform_mission_timer"
			country_event = shx.agri.2
		}
	}
}

SHX_QIE_ties = {#在北京的阴影下
	SHX_switch_payment = {#切换支付方式
		icon = GFX_decision_gre_investment_decisions
		fire_only_once = no
		ai_will_do = {
			base = 0
			modifier = {
				factor = 0
				has_country_flag = SHX_ai_limit_payment_swaps
			}
			modifier = {
				factor = 0
				has_country_flag = SHX_paying_with_pp 
			}
			modifier = {
				add = 5
				AND = {
					has_country_flag = SHX_paying_with_inf
					check_variable = { SHX.SHX_QIE_influence_variable > 10 }
				}
			}
			modifier = {
				add = 5
				AND = {
					has_country_flag = SHX_paying_with_inf
					has_political_power > 100
				}
			}
			modifier = {
				add = 5
				AND = {
					has_country_flag = SHX_paying_with_pp
					has_political_power < 100
				}
			}
			modifier = {
				add = 10
				AND = {
					has_country_flag = SHX_paying_with_pp
					check_variable = { SHX.SHX_QIE_influence_variable < 10 }
				}
			}
			modifier = {
				add = 10000
				has_country_flag = SHX_paying_with_inf #opposite of above - switch away from buying with influence if has anti beijing path
				OR = {
					AND = { #check if they have a non-QIE forpol rule set
						NOT = { has_game_rule = { rule = SHX_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = SHX_forpol option = SHX_FORPOL_QIE } }
					}
					has_game_rule = { rule = SHX_path option = SHX_PATH_AUTDEM }
				}
			}
		}
		visible = {
			SHX_QIE_influence_active = yes
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_switch_payment"
			set_country_flag = { 
				flag = SHX_ai_limit_payment_swaps 
				days = 90 
				value = 1 
			}
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				custom_effect_tooltip = SHX_change_to_paying_with_inf_tooltip
				clr_country_flag = SHX_paying_with_pp
				set_country_flag = SHX_paying_with_inf
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				custom_effect_tooltip = SHX_change_to_paying_with_pp_tooltip
				clr_country_flag = SHX_paying_with_inf
				set_country_flag = SHX_paying_with_pp
			}
		}
	}
	SHX_suiyuan_betrayal_decision = {#背叛中央政府
  		icon = GFX_decision_freedom
		allowed = { always = no }
		available = {
			ROOT = {
				has_war = no
				is_subject_of = FROM
				# has_autonomy_state = associated_governorate 
			}
		}
		cost = 100
		ai_will_do = {
			base = 0
			modifier = {
				add = 100
				FROM = { surrender_progress > 0.5 }
			}
			modifier = {
				add = 100
				strength_ratio = {
					tag = FROM
					ratio > 1
				}
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_suiyuan_betrayal_decision target: [From.GetName]"
			ROOT = { china_break_puppet_effect = yes }
			FROM = { 
				country_event = { 
					id = shx.suiyuan.campaign.60 
					days = 3 
				} 
			}
			custom_effect_tooltip = SHX_suiyuan_may_lead_to_war_tooltip
		}
	}
	
	SHX_seek_loan_from_beijing = {#寻求一项贷款
		icon = GFX_decision_generic_agreement
		visible = { SHX_QIE_influence_active = yes }
		custom_cost_text = SHX_QIE_eco_invest_large_texticon
		custom_cost_trigger = {
			always = yes
		}
		days_re_enable = 100

		ai_will_do = {
			base = 0
			modifier = {
				add = 2
				has_political_power < -49
			}
			modifier = {
				add = 3
				has_political_power < -99
			}
			modifier = {
				add = 2
				check_variable = { SHX.SHX_QIE_influence_variable < 35 }
				has_political_power < 100
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_seek_loan_from_beijing"
			SHX_QIE_investment_large = yes
			add_political_power = 125
		}
	}

	SHX_hire_qie_labour = {#从直隶省雇佣熟练劳工
		icon = GFX_decision_cement_mixer
		visible = {
			SHX_QIE_influence_active = yes
			num_of_factories < 12
		}
		cancel_trigger = { 
			QIE = { exists = no } 
		}
		custom_cost_text = SHX_QIE_eco_invest_choice_medium_texticon
		custom_cost_trigger = {
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				has_political_power > SHX_pay_with_pp_medium_variable
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				SHX_QIE_influence_max_check = yes
			}
		}
		days_re_enable = 150
		modifier = {
			production_speed_buildings_factor = 0.2
		}
		days_remove = 100
		ai_will_do = {
			base = 0
			modifier = {
				factor = 0
				num_of_civilian_factories_available_for_projects < 5
			}
			modifier = {
				add = 2
				has_political_power > 200
				has_country_flag = SHX_paying_with_pp
			}
			modifier = {
				add = 2
				check_variable = { SHX.SHX_QIE_influence_variable < 40 }
				has_country_flag = SHX_paying_with_inf
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_hire_qie_labour"
			add_tech_bonus = {
				name = SHX_hire_qie_labour
				bonus = 0.25
				uses = 1
				category = industry
			}
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				hidden_effect = {
					set_temp_variable = { SHX_PP_cost = SHX_pay_with_pp_medium_variable } #Variable Set in History File
					multiply_temp_variable = { SHX_PP_cost = -1 }
					add_political_power = SHX_PP_cost
				}
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				SHX_QIE_investment_medium = yes
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_hire_qie_labour"

		}
	}
	SHX_hire_qie_labour2 = {#从直隶省雇佣熟练劳工
		icon = GFX_decision_cement_mixer

		visible = {
			SHX_QIE_influence_active = yes
			num_of_factories > 12
		}
		cancel_trigger = { 
			QIE = { 
				exists = no 
			} 
		}
		custom_cost_text = SHX_QIE_eco_invest_choice_medium_texticon
		custom_cost_trigger = {
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				has_political_power > SHX_pay_with_pp_medium_variable
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				SHX_QIE_influence_max_check = yes
			}
		}
		days_re_enable = 150
		modifier = {
			production_speed_buildings_factor = 0.1
		}
		days_remove = 100
		ai_will_do = {
			base = 0
			modifier = {
				factor = 0
				num_of_civilian_factories_available_for_projects < 5
			}
			modifier = {
				add = 2
				has_political_power > 200
				has_country_flag = SHX_paying_with_pp
			}
			modifier = {
				add = 2
				check_variable = { SHX.SHX_QIE_influence_variable < 40 }
				has_country_flag = SHX_paying_with_inf
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_hire_qie_labour2"
			add_tech_bonus = {
				name = SHX_hire_qie_labour
				bonus = 0.25
				uses = 1
				category = industry
			}
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				hidden_effect = {
					set_temp_variable = { SHX_PP_cost = SHX_pay_with_pp_medium_variable } #Variable Set in History File
					multiply_temp_variable = { SHX_PP_cost = -1 }
					add_political_power = SHX_PP_cost
				}
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				SHX_QIE_investment_medium = yes
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_hire_qie_labour2"

		}
	}

	SHX_military_construction_crews = {#雇佣军事建设人员
		icon = GFX_decision_generic_motorized
		visible = {
			SHX_QIE_influence_active = yes
		}
		cancel_trigger = { QIE = { exists = no } }
		custom_cost_text = SHX_QIE_eco_invest_choice_medium_texticon
		custom_cost_trigger = {
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				has_political_power > SHX_pay_with_pp_medium_variable
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				SHX_QIE_influence_max_check = yes
			}
		}
		days_re_enable = 150
		modifier = {
			production_speed_arms_factory_factor = 0.10
			industrial_capacity_factory = 0.1
		}
		days_remove = 100
		ai_will_do = {
			base = 0
			modifier = {
				factor = 0
				num_of_civilian_factories_available_for_projects < 5
			}
			modifier = {
				add = 2
				has_political_power > 200
				has_country_flag = SHX_paying_with_pp
			}
			modifier = {
				add = 2
				check_variable = { SHX.SHX_QIE_influence_variable < 40 }
				has_country_flag = SHX_paying_with_inf
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_military_construction_crews"
			if = {
				limit = { has_country_flag = SHX_paying_with_pp }
				hidden_effect = {
					set_temp_variable = { SHX_PP_cost = SHX_pay_with_pp_medium_variable } #Variable Set in History File
					multiply_temp_variable = { SHX_PP_cost = -1 }
					add_political_power = SHX_PP_cost
				}
			}
			else_if = {
				limit = { has_country_flag = SHX_paying_with_inf }
				SHX_QIE_investment_medium = yes
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_military_construction_crews"

		}
	}
}

SHX_QIE_shanxi_diplomacy_decisions_category = {#我们在山西的利益
	SHX_QIE_relief_for_shanxi = {#黑色星期一救济一揽子协议
		icon = GFX_decision_give_cash
		visible = {
			AND = {
				SHX = {
					exists = yes
					has_completed_focus = SHX_jie_jue_hei_she_xing_qi_yi
					NOT = {
						has_country_flag = SHX_reject_BM_relief
					}
				}
				has_country_flag = QIE_influence_shanxi_available
				# NOT = { 
				# 	SHX = { 
				# 		has_completed_focus = SHX_destiny 
				# 	} 
				# }
			}
		}
		available = {
			SHX = {
				has_completed_focus = SHX_jie_jue_hei_she_xing_qi_yi
				NOT = {
					has_country_flag = SHX_reject_BM_relief
				}
			}
			NOT = { has_war_with = SHX }

			num_of_civilian_factories_available_for_projects > 3
		}
		cancel_trigger = {
			OR = {
				SHX = { has_country_flag = SHX_reject_BM_relief }
				SHX = { exists = no }
			}
		}
		fire_only_once = yes
		ai_will_do = { factor = 5 }
		days_remove = 100
		cost = 10
		modifier = {
			civilian_factory_use = 3
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete SHX_QIE_relief_for_shanxi"
			SHX = {
				country_event = { id = shx.QIE.aid.5 days = 3 } #Black Monday Relief Package
			}
			custom_effect_tooltip = tooltip_white_line
			custom_effect_tooltip = SHX_QIE_relief_for_shanxi_tooltip
		}
		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancel SHX_QIE_relief_for_shanxi"
			add_political_power = 10
		}
	}
}

SHX_Foreign_Policy_decisions = {
	SHX_Attack_QIE = {
		icon = generic_prepare_civil_war

		visible = {
			has_government = paternal_autocrat
			NOT = { has_country_flag = QIE_yan_backs_coup }
			is_in_faction = no
			can_declare_war_on = FROM
			FROM = {
				has_war_with = FNG
			}
		}

		targets = { QIE }
		target_root_trigger = {
			has_government = paternal_autocrat
			NOT = { has_country_flag = QIE_yan_backs_coup }
			is_in_faction = no
		}
		target_trigger = {
			can_declare_war_on = FROM
			FROM = {
				has_war_with = FNG
			}
		}

		cost = 20
		days_remove = 14
		fire_only_once = yes
		cancel_if_not_visible = yes
		war_with_target_on_remove = yes

		ai_will_do = {
			factor = 1000
			modifier = {
				factor = 0
				surrender_progress > 0
			}
			modifier = {
				factor = 0
				has_country_flag = imminent_war
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision SHX_Attack_QIE target: [From.GetName]"
			set_country_flag = { flag = imminent_war days = 20 value = 1 }
			set_country_flag = SHX_alliance_FNG
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_Attack_QIE target: [From.GetName]"
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
	}
	SHX_Begin_The_Eastern_Expedition = {
		icon = generic_prepare_civil_war

		visible = {
			has_completed_focus = SHX_Fengs_Crusade
			can_declare_war_on = FROM
			FROM = {
				is_chinese_tag = yes
				owns_state = 608
			}
		}

		targets = { 608.OWNER }
		target_root_trigger = {
			has_completed_focus = SHX_Fengs_Crusade
		}
		target_trigger = {
			can_declare_war_on = FROM
			FROM = {
				is_chinese_tag = yes
				owns_state = 608
			}
		}

		cost = 20
		days_remove = 14
		fire_only_once = yes
		cancel_if_not_visible = yes
		war_with_target_on_remove = yes

		ai_will_do = {
			factor = 1000
			modifier = {
				factor = 0
				surrender_progress > 0
			}
			modifier = {
				factor = 0
				FROM = { has_war = no }
			}
			modifier = {
				factor = 0
				strength_ratio = {
					tag = FROM
					ratio < 0.5
				}
			}
			modifier = {
				factor = 0
				has_country_flag = imminent_war
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision SHX_Begin_The_Eastern_Expedition"
			set_country_flag = { flag = imminent_war days = 20 value = 1 }
			hidden_effect = {
				add_ai_strategy = {
					type = prepare_for_war
					id = FROM
					value = 1000
				}
				FROM = {
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 1000
					}
				}
			}
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_Begin_The_Eastern_Expedition"
			hidden_effect = {
				add_ai_strategy = {
					type = prepare_for_war
					id = FROM
					value = -1000
				}
				FROM = {
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = -1000
					}
				}
			}
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
	}

	#Join faction if already aligned
	SHX_Join_Faction = {
		icon = generic_flags

		visible = {
			is_in_faction = no
			has_country_flag = SHX_alliance_@FROM
			FROM = {
				is_faction_leader = yes
				NOT = { has_war_with = ROOT }
			}
		}

		targets = {	CHI YUN GXC SZC FNG }
		target_trigger = {
			FROM = {
				is_faction_leader = yes
				NOT = { has_war_with = ROOT }
			}
		}

		cost = 0
		cancel_if_not_visible = yes

		ai_will_do = {
			base = 1000
			modifier = {
				factor = 0
				FROM = {
					surrender_progress > 0.2
				}
			}
			modifier = {
				factor = 0
				has_war = yes
				FROM = {
					has_war = yes
				}
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision SHX_Join_Faction target: [From.GetName]"
			FROM = {
				add_to_faction = ROOT
			}
		}
	}

	SZC_Approach_The_Kuomintang = {
		icon = generic_agreement

		visible = {
			is_in_faction = no
			has_completed_focus = SHX_Join_The_Fray
			NOT = {
				has_country_flag = SHX_alliance_CHI
				has_country_flag = SHX_alliance_YUN
				has_country_flag = SHX_alliance_GXC
				has_country_flag = SHX_alliance_SZC
			}
			FROM = {
				exists = yes
				is_ruled_by_kmt = yes
				OR = {
					is_in_faction = no
					is_faction_leader = yes
				}
				NOT = { has_war_with = ROOT }
			}
		}

		targets = {	CHI }
		target_root_trigger = {
			is_in_faction = no
			has_completed_focus = SHX_Join_The_Fray
		}
		target_trigger = {
			FROM = {
				is_ruled_by_kmt = yes
				OR = {
					is_in_faction = no
					is_faction_leader = yes
				}
				NOT = { has_war_with = ROOT }
			}
		}

		cost = 25
		fire_only_once = yes
		cancel_if_not_visible = yes

		ai_will_do = {
			base = 20
			#Prefers the Federalists
			modifier = {
				add = -20
				OR = {
					GXC = { GXC_has_federalist_government = yes }
					SZC = { SZC_federalists_in_exile = yes }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					surrender_progress > 0.2
				}
			}
			modifier = {
				factor = 0
				has_war = yes
				FROM = {
					has_war = yes
				}
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision SZC_Approach_The_Kuomintang target: [From.GetName]"
			FROM = {
				country_event = shx.64
			}
		}
	}

	SZC_Approach_The_Federalists = {
		icon = generic_agreement

		visible = {
			is_in_faction = no
			has_completed_focus = SHX_Join_The_Fray
			NOT = {
				has_country_flag = SHX_alliance_CHI
				has_country_flag = SHX_alliance_YUN
				has_country_flag = SHX_alliance_GXC
				has_country_flag = SHX_alliance_SZC
			}
			FROM = {
				exists = yes
				is_ruled_by_federalists = yes
				OR = {
					is_in_faction = no
					is_faction_leader = yes
				}
				NOT = { has_war_with = ROOT }
			}
		}

		targets = {	GXC SZC }
		target_root_trigger = {
			is_in_faction = no
			has_completed_focus = SHX_Join_The_Fray
		}
		target_trigger = {
			FROM = {
				is_ruled_by_federalists = yes
				OR = {
					is_in_faction = no
					is_faction_leader = yes
				}
				NOT = { has_war_with = ROOT }
			}
		}

		cost = 25
		fire_only_once = yes
		cancel_if_not_visible = yes

		ai_will_do = {
			base = 40
			modifier = {
				factor = 0
				FROM = {
					surrender_progress > 0.2
				}
			}
			modifier = {
				factor = 0
				has_war = yes
				FROM = {
					has_war = yes
				}
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision SZC_Approach_The_Federalists target: [From.GetName]"
			FROM = {
				country_event = shx.64
			}
		}
	}

	SHX_Seize_Lanzhou = {
		icon = ger_military_buildup

		visible = {
			has_global_flag = northwest_conflict_begun
			NOT = { has_global_flag = northwest_conflict_ended }
			FROM = {
				owns_state = 283
				controls_state = 283
				surrender_progress > 0.8
				OR = {
					has_war_with = MON
					has_war_with = TIB
				}
			}
		}

		targets = {	XSM }
		target_trigger = {
			FROM = {
				OR = {
					has_war_with = MON
					has_war_with = TIB
				}
			}
		}

		cost = 15
		days_remove = 14
		fire_only_once = yes

		ai_will_do = {
			base = 1000
			modifier = {
				factor = 0
				has_war = yes
			}
			modifier = {
				factor = 0
				is_in_faction = yes
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision SHX_Seize_Lanzhou target: [From.GetName]"
			add_state_claim = 283
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_Seize_Lanzhou target: [From.GetName]"
			FROM = {
				country_event = shx.31
			}
		}
	}

	SHX_Integrate_Lanzhou = {
		icon = ger_military_buildup

		available = {
			has_full_control_of_state = 283
		}
		visible = {
			283 = { is_fully_controlled_by_ROOT_and_is_not_core_of_ROOT = yes }
		}

		modifier = {
			political_power_gain = -0.15
		}

		cost = 50
		days_remove = 60
		fire_only_once = yes

		ai_will_do = {
			base = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove SHX_Integrate_Lanzhou"
			283 = { remove_claim_by_ROOT_and_add_core_of_ROOT = yes }
		}
	}
}